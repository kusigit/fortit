{"version":3,"file":"fwc-data-table.js","sourceRoot":"","sources":["fwc-data-table.ts"],"names":[],"mappings":"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","sourcesContent":["import { msg } from '@lit/localize';\nimport { TemplateResult, html, css, LitElement } from 'lit';\nimport { customElement } from 'lit/decorators/custom-element.js';\nimport { property } from 'lit/decorators/property.js';\nimport { state } from 'lit/decorators/state.js';\nimport { formatDate, dynMsg } from '../base.js';\n\n@customElement('fwc-data-table')\nexport class FwcDataTable extends LitElement {\n  static styles = css`\n    table {\n      width: 100%;\n      border-spacing: 0;\n      border-collapse: collapse;\n      position: relative;\n      table-layout: fixed;\n      --mdc-icon-button-size: 32px;\n    }\n\n    table th {\n      font-size: 12px;\n      font-weight: 500;\n      height: 56px;\n      line-height: 56px;\n      padding: 0 var(--padding-small) 0 var(--padding-small);\n      text-align: left;\n    }\n\n    :host-context([mode='modal']) table th,\n    :host-context([mode='modal']) table td {\n      padding: 0 var(--padding-small) 0 0;\n    }\n\n    :host-context([mode='modal']) table th:not(.wide),\n    :host-context([mode='modal']) table td:not(.wide) {\n      padding-right: 0;\n    }\n\n    table .actions {\n      position: absolute;\n      left: 0;\n      right: 0;\n      padding: 9.5px var(--padding-small);\n      margin-top: -51px;\n      opacity: 0;\n      text-align: right;\n      background: linear-gradient(\n        -90deg,\n        var(--material-color-grey-100) 230px,\n        rgba(0, 0, 0, 0.04) 230px\n      );\n    }\n\n    table .actions:hover,\n    table tr:hover + .actions {\n      opacity: 1;\n    }\n\n    table th .header {\n      display: flex;\n      align-items: center;\n      white-space: nowrap;\n    }\n\n    table th .title {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      margin-right: 8px;\n    }\n\n    table th mwc-icon-button {\n      height: 24px;\n      vertical-align: middle;\n      visibility: hidden;\n      transform: rotate(90deg);\n      --mdc-icon-button-size: 24px;\n    }\n\n    table th:hover mwc-icon-button {\n      color: gray;\n      display: inline-block;\n      visibility: visible;\n    }\n\n    table th mwc-icon-button.asc {\n      visibility: visible;\n      transform: rotate(90deg);\n    }\n\n    table th mwc-icon-button.desc {\n      visibility: visible;\n      transform: rotate(-90deg);\n    }\n\n    table thead .action {\n      border-bottom: 1px solid rgba(0, 0, 0, 0.12);\n    }\n\n    table.wide th:last-child {\n      padding-right: var(--padding-medium);\n    }\n\n    table.wide td:last-child {\n      padding-right: 0;\n    }\n\n    table tbody td {\n      font-size: 13px;\n      height: 51px;\n      white-space: nowrap;\n      padding: 0 var(--padding-small) 0 var(--padding-small);\n      border-top: 1px solid rgba(0, 0, 0, 0.12);\n    }\n\n    table th.right,\n    table td.right {\n      text-align: right;\n      padding-right: 16px;\n    }\n\n    table tbody td mwc-checkbox {\n      margin-left: -15px;\n    }\n\n    table thead .filter th {\n      height: 51px;\n      border-top: 1px solid rgba(0, 0, 0, 0.12);\n    }\n\n    table input[type='text'] {\n      outline: none;\n      width: 100%;\n      padding: 4px 0;\n      border-color: rgba(0, 0, 0, 0.38);\n      border-width: 0 0 1px 0;\n      background-color: transparent;\n    }\n\n    table input[type='text']:hover {\n      border-color: black;\n    }\n\n    table input[type='text']:focus {\n      border-color: var(--mdc-theme-primary);\n    }\n\n    :host-context([mode='modal']) table .filter,\n    :host-context([mode='modal']) table .wide,\n    :host-context([mode='modal']) table .actions {\n      display: none;\n    }\n\n    .action-row {\n      display: flex;\n      align-items: center;\n    }\n\n    .action-row mwc-button {\n      margin-left: -8px;\n    }\n\n    .selection {\n      flex-grow: 1;\n      padding-left: var(--padding-medium);\n    }\n\n    table tr.remove {\n      border-bottom-color: rgba(var(--mdc-theme-secondary-rgb), 0.5);\n      background-color: rgba(var(--mdc-theme-secondary-rgb), 0.5);\n    }\n\n    @media screen {\n      table tbody tr.error {\n        background-color: var(--paper-red-50);\n      }\n    }\n  `;\n\n  @property({ type: Array })\n  actions: any[] = [];\n\n  @property({ type: Array })\n  columns: string[] = [];\n\n  @property({ type: Array })\n  items: any[] = [];\n\n  @state()\n  allItems: any[] = [];\n\n  @state()\n  filter: { [field: string]: string } = {};\n\n  @state()\n  order: { [field: string]: string } = {\n    name: 'asc',\n  };\n\n  protected render(): TemplateResult {\n    return html`\n      <table>\n        <thead>\n          <tr>\n            ${this.columns.map(\n              (column: string) => html`\n                <th>\n                  <span class=\"header\">\n                    <span class=\"title\">${dynMsg(column)}</span>\n                    <mwc-icon-button\n                      class=\"${this.order[column]}\"\n                      icon=\"arrow_forward\"\n                      @click=\"${() => this.sort(column)}\"\n                    ></mwc-icon-button>\n                  </span>\n                </th>\n              `\n            )}\n          </tr>\n          <tr>\n            ${this.columns.map(\n              (column: string) => html`\n                <th>\n                  <input\n                    type=\"text\"\n                    placeholder=\"${msg(`Filter...`)}\"\n                    @input=\"${(event: { target: HTMLFormElement }) => {\n                      this.setFilter(column, event.target.value);\n                    }}\"\n                  />\n                </th>\n              `\n            )}\n          </tr>\n        </thead>\n        <tbody>\n          ${this.items.map(\n            (item: any) => html`\n              <tr class=\"${item.checked ? 'selected' : ''}\">\n                ${this.columns.map(\n                  (column: string) => html`\n                    <td class=\"ellipsis\" title=\"${item[column]}\">\n                      ${item[column]}\n                    </td>\n                  `\n                )}\n                <div class=\"actions\">\n                  ${this.actions.map(\n                    (action: any) => html`\n                      <mwc-icon-button\n                        icon=\"${action.icon}\"\n                        title=\"${action.title}\"\n                        @click=\"${() => action.click(item.id)}\"\n                      ></mwc-icon-button>\n                    `\n                  )}\n                </div>\n              </tr>\n            `\n          )}\n        </tbody>\n      </table>\n    `;\n  }\n\n  private setFilter(field = '', value = '') {\n    if (value === '') {\n      delete this.filter[field];\n    } else {\n      this.filter[field] = value;\n    }\n\n    if (this.allItems.length === 0) {\n      this.allItems = this.items;\n    }\n\n    this.items = this.allItems.filter((item: any) =>\n      Object.entries(this.filter).every(([key, search]) => {\n        let val = item[key];\n\n        switch (key) {\n          case 'state':\n            val = dynMsg(item[key]);\n            break;\n\n          case 'changed_at':\n          case 'created_at':\n          case 'date':\n          case 'last_assessment':\n            val = formatDate(item[key]);\n            break;\n\n          default:\n            break;\n        }\n\n        const regEx = new RegExp(search, 'i');\n        return regEx.test(val);\n      })\n    );\n  }\n\n  private sort(field: string) {\n    Object.keys(this.order).forEach((f) => {\n      if (f !== field) {\n        delete this.order[f];\n      }\n    });\n\n    this.order[field] = this.order[field] === 'asc' ? 'desc' : 'asc';\n    const items = [...this.items];\n\n    items.sort((a: unknown, b: unknown) => {\n      if (this.order[field] === 'asc') {\n        // @ts-ignore\n        return a[field] > b[field] ? 1 : -1;\n      }\n      // @ts-ignore\n      return a[field] < b[field] ? 1 : -1;\n    });\n\n    this.items = items;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'fwc-data-table': FwcDataTable;\n  }\n}\n"]}